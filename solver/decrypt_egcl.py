from Crypto.Cipher import AES
from hashlib import sha256
import sys

# Constants
ct = b'\xc6*\x17\xcce\xc1y\xb8\xb4\x8d\x87L\xf8\x81QK\xf4\x02\xf2\xf7\x8d\xe0\xe8\x92\xc7\xe7\x8fg\xb1M\xb4.\x89\x18\xf5\x7f\xed\xc3I\x92\x82\xfd\xfe9\x95\xc9(\x90\xce\x93\xb9+\xce\x958\xf3\x05PH'
nonce = b'6\xe7m\xcc\x8e\x0eG '

candidates = [
    20832602754954773650114493159432630748472373512301516690395194675485267,
    236417405737954684878107051143682722540469728561742840714263422918992901,
    1037604115432370675130529101570596061491802431794702019921269775392610996,
    837154379254252165387506838600527732168565426640859172624854119684235505,
    257680585471460248869438832765684063106349437098421520150583516614810475,
    1546104694792960768278455073641848103490774184979818823884313010132161063,
    2120824506028752076226370690320364611205231077734481806891985291591927940,
    2765792319119612932582191476291081431850783899024011102312444106821920014,
    1596026551315143822251502621864195878114172097465050909465365674995636433,
    1584455354092343274774856917818498704915920961915300529007035314698122815,
    2276174925362592381795021980638663779413327966888381354620824345881190094,
    834924857162827850442344199350930311355339859807280802004287158787725313,
    1101365796801803381085583941058070845237264456415915529389747754966929250,
    2602733005594181676724336779751617789460178734402196936058754348574542193,
    2974797360788759149997531821481686133416884978859824940973601303309865809,
    2043390048624670893855898707880864008482021843238029223198899677207110040,
    3037582986622347448215632855129607482748865595880440165479933521383382001,
    1429445834816151274421733142727957699638415985876443479300552235662670344,
    1,
    401363719997569479885267861030578567801088430347757703988428320793501769
]

def decrypt(d_val):
    try:
        key = sha256(str(d_val).encode()).digest()
        cipher = AES.new(key, AES.MODE_CTR, nonce=nonce)
        pt = cipher.decrypt(ct)
        # print(f"Attempting d={d_val}")
        # print(f"Decrypted: {pt}")
        if b'CTF' in pt or b'flag' in pt:
            print(f"SUCCESS! Flag found for d={d_val}")
            print(f"Flag: {pt.decode(errors='ignore')}")
            return True
    except Exception as e:
        print(f"Error: {e}")
    return False

if __name__ == "__main__":
    found = False
    for candidate in candidates:
        if decrypt(candidate):
            found = True
            break
            
    if not found:
        print("No valid flag found in candidates.")
